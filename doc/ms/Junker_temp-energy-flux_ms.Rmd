---
title: "Environmental warming increases the absolute and relative importance of high-turnover energy channels in stream food webs"
author:
  - James R. Junker:
      email: jrjunker@mtu.edu
      institute: [msu, glrc]
      correspondence: true
  - name: Wyatt F. Cross
    institute: msu
  - name: James M. Hood
    institute: osu
  - name: Jonathan P. Benstead
    institute: bama
  - name: Alex D. Huryn
    institute: bama
  - name: Daniel Nelson
    institute: usu
  - name: Jón S. Ólafsson
    institute: veidi
  - name: Gísli M. Gíslason
    institute: reyk
institute:
  - msu: Department of Ecology, Montana State University, Bozeman, MT 59717, USA
  - glrc: Current `address:` Great Lakes Research Center, Michigan Technological University, Houghton, MI 49931, USA
  - osu: Department of Evolution, Ecology, and Organismal Biology, The Ohio State University, Translational Data Analytics Institute, The Aquatic Ecology Laboratory, Columbus, OH 43212, USA
  - bama: Department of Biological Sciences, University of Alabama, Tuscaloosa, AL  35487, USA
  - usu: National Aquatic Monitoring Center, Department of Watershed Sciences, Utah State University, Logan, UT 84322, USA
  - veidi: Institute of Marine and Freshwater Fisheries, Reykjavik, Iceland
  - reyk: Univeristy of Iceland, Institute of Life and Environmental Sciences, Reykjavik, Iceland
output:
   word_document:
      reference_docx: working_docx_template.docx
      toc: no
      pandoc_args:
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
   pdf_document:
     keep_tex: true
   html_document: default
   pandoc_args:
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
header-includes:
- \usepackage{lineno}
- \usepackage{amsmath}
- \usepackage{indentfirst}
- \linenumbers
indent: true
linestretch: 1
bibliography: refs.bib
link-citations: no
link-color: grey
csl: ecology.csl
---

```{r import general objects, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)
source("./packages.R")
library(knitr)

drake::loadd(temperature_stats)
n_boot = temperature_stats[['n_boot']]


```
<!--- Title page details --->
<!-- \setlength\parindent{24pt}\setlength{\parskip}{0.0pt plus 1.0pt} -->

\newpage

<!--- this is a note in Rmarkdown --->
# Abstract

Warming temperatures are altering communities and trophic networks globally. While the influence of warming on food webs is often context-dependent, increasing temperatures are predicted to influence communities in two fundamental ways: 1) by reducing average body size and 2) by increasing individual metabolic rates. Both body size and metabolic rate are important drivers of many ecological patterns. Therefore, warming-induced changes have the potential to propagate through countless ecosystem processes thereby altering the distribution of food web fluxes, food web stability, and potentially the importance of environmental and biological factors in community assembly. Here, we quantify the patterning and relative distribution of organic matter fluxes through stream food webs spanning a natural ~25$^\circ$C temperature gradient. We then related patterns in fluxes to species and community traits (body size, *M* and biomass turnover, *P:B*) within and across ecosystems. We predicted 1) warmer communities would skew towards smaller *M* and higher *P:B* across ecosystems, 2) organic matter fluxes within communities would increasingly skew towards smaller, higher *P:B* populations at higher temperatures. Across the temperature gradient, communities in warmer streams were composed of smaller-bodied and higher-turnover populations on average. Additionally, material fluxes of warmer streams were increasingly skewed towards high-turnover populations *within* the community, showing higher temperatures restructured organic matter fluxes in both an absolute and relative sense. With warming, the relative distribution of organic matter fluxes also appeared to be increasingly 'non-random', suggesting the potential for stronger selection for these traits with increasing temperature. The emerging picture is a warmer world that is both smaller and faster. Our study provides clear empirical support for this pattern in natural communities and suggests that warming has the potential to shape pathways of energy and material flows in food webs in ways that may be predictable.

# Introduction

<!--- warming and effects in food webs --->
<!--- Speeding up of food web: Species levels--->
Increasing global temperatures can influence the provision and maintenance of ecosystem services by modifying the network of species interactions that underpin ecosystem functions [@brose2012; @woodward2010; @deruiter1995; @thompson2012]. The effects of warming permeate across levels of biological organization from its control on individual metabolic rates [@gillooly2001; @brown2004] and biological activity (e.g., attack rate, handling time, growth rates, etc.; @dell2014, to broad-scale shifts in community assembly and structure [@saito2021; @gibert2019a; @nelson2017a]. Across global climate gradients, these temperature-induced changes have the potential to mediate food web stability [@baiser2019] by altering the acquisition and allocation of resources among species [@zhang2017] and the magnitudes and relative distribution of energy fluxes among species and trophic levels [@may1972; @mccann1998; @barnes2018].

Understanding how warming alters energy fluxes in food webs requires information about how temperature modifies connections between ecosystem structure (i.e. biodiversity) and function (BEF). The extent to which temperature modifies the relative importance of community assembly processes will mediate changes to ecosystem structure and function with warming within and among ecosystems. These processes are varied--from strictly deterministic [\ e.g., environmental/niche filtering, @whittaker1962],  to strictly stochastic [\ e.g., neutral theory, @hubbell2001]--and they operate across multiple scales. As such, there are a multitude of possible relationships between warming and species' abundance and trait distributions. For example, strong environmental filtering can be expected to mediate the number of species in a community and is likely to skew trait distributions, to some extent, in natural communities [@therriault1999]. However, the relative distribution of traits can be modified by a number of additional processes beyond environmental filtering that alter species relative abundance distributions [\ e.g., species interactions @therriault1999 and demographic stochasticity @hubbell2001]. These additional processes can exaggerate or counter any skew in trait distribution imparted through environmental filtering and may therefore be important for understanding the warming response in species and communities and the absolute and relative distribution of organic matter fluxes across gradients in species traits.

Although temperature appears to have minimal control on species richness across taxonomic groups [e.g., @bastazini2021], warming may have profound effects on the dominance structure (i.e. evenness) of ecological communities, often by reducing community evenness and favoring a few well-adapted species [@hillebrand2008]. The implications of these changes on the magnitude and pathways of energy flux in food webs should depend on how warming influences functional trait distributions, as well as how these functional traits translate to energy demands [@loreau2001; @norberg2001; @norberg2004]. 

<!--- Connect traits to the 'speed' of ecosystem energy fluxes--->
Body size is a fundamental trait that is strongly influenced by temperature and has great potential to influence energy flux [@atkinson1994; @gardner2011; @daufresne2009]. Body size reductions arise from multiple mechanisms acting at different levels of organization, such as the increased relative abundance of smaller species within warmer communities [@bergmann1848], or smaller individuals in warmer populations [@james1970], or through reduced body size of warmer individuals [@atkinson1994]. Temperature-size relationships (TSR) are likely to influence the distribution of body sizes both across and within ecosystems, such that warmer communities should contain smaller species and populations, on average, and smaller organisms should be more dominant within a community. These changes can have important implications for ecosystems pattern and processes that control energy and material fluxes in ecosystems because body size is a strong determinant of an organism's biology [@peters1983] influencing, life history patterns [@zeuss2017; @altermatt2010; @nelson2020b], and developmental [@angilletta2004] and metabolic rates [@brown2004; @gillooly2001].

<!--- Write the main goals of the paragraph--->
Metabolic rate, in addition to being controlled by body size, is a second key trait that is influence by temperature and tied to variation in energy flux through food webs [@gillooly2001; ]. Warming can influence metabolic indirectly through reductions in body size, as well as directly through its effects on subcellular kinetics [@bideault2019; @osmond2017]. These processes has been shown to modify ecosystem patterns through changes in population abundance [@bernhardt2018], consumer-resource interactions [@bideault2019], and food web structure [@gibert2019a]. Importantly, the kinetic effects of temperature are tied to many biological processes [@dell2014], among them growth rate [@gillooly2001], developmental rate [@zuo2012; @nelson2020b], voltinism [@zeuss2017], and population turnover rate [@huryn2007; @brown2004]. Taken together, these changes suggest a smaller, faster world in which warming "speeds up" ecosystem processes through the compounded effects of smaller body size and higher turnover rates, with potentially lasting imprints on food web structure and energy fluxes [@gibert2019a]. 

Here, we measured the patterning and distribution of organic matter fluxes within invertebrate food webs across a natural stream temperature gradient (\~5--28$^\circ$C). Previous research in these streams has shown a strong positive effect of temperature on primary production both among streams [@demars2011; @padfield2017] and within streams seasonally [@ogorman2012; @hood2018]. Consumers rely largely on autochthonous resources [@ogorman2012; @nelson2020] and therefore the dynamics of primary production have a strong control on consumer energy demand [@junker2020]. As such, we predicted annual organic matter fluxes to consumers would increase with temperature across streams mirroring among-stream patterns in resource availability and consumer energy demand. We hypothesized temperature to be a strong environmental filter of community assembly and the distribution of energy and organic matter fluxes. From this we made a number of predictions regarding the patterning of organic matter fluxes within and across communities of different temperature, with particular focus on two species traits; body size and population biomass turnover (production:biomass ratios, *P:B*). First, we predict warmer temperatures should favor smaller and faster turnover species leading to a decrease in body sizes and increase in *P:B* on average across communities. Second, within communities organic matter fluxes should be increasingly dominated by smaller, higher turnover species at warmer temperatures. Lastly, we quantify the probability that patterns of organic matter fluxes among populations arise from chance versus the potential for temperature to structure the relative distribution of material fluxes along species trait axes.

# Methods

We studied six streams within the Hengill geothermal field of southwestern Iceland (64$^\circ$ 03'N 021$^\circ$ 18'W) that varied in mean annual temperature. Hengill is
characterized by indirect geothermal heating of groundwater [@arnason1969], leading to natural variability in water temperatures (4.5--54.0 $^\circ$C), but similar solute
chemistries [@friberg2009]. These conditions create a "natural laboratory" for isolating the effects of temperature on ecosystem processes [@ogorman2014; @nelson2017a]. We selected
streams to maximize the temperature range, while minimizing differences in the structural aspects of primary producers. In each stream, we measured temperature and water depth
every 15 min from July 2010 through August 2012 (U20-001-01 water-level logger, Onset Computer Corp. Pocasset, MA, USA). Light availability in the watershed was measured every 15
min from atmospheric stations (HOBO pendant temperature/light UA-002-64, Onset Computer Corp. Pocasset, MA, USA).

## Invertebrate sampling

We sampled macroinvertebrate communities approximately monthly from July 2011 to August 2012 in four streams and from October 2010 to October 2011 in two streams used in a previous
study (*n* = 6 streams). The two streams were part of an experiment beginning October 2011, therefore overlapping years were not used to exclude the impact of experimental
manipulation [@nelson2017; @nelson2017a]. Inter-annual comparisons of primary and secondary production in previous studies showed minimal differences among years in
unmanipulated streams, suggesting that combining data from different years would not significantly bias our results [@nelson2017; @hood2018]. We collected five Surber samples
(0.023 m^2^, 250 $\mu$m mesh) from randomly selected locations within each stream. Within the sampler, inorganic substrates were disturbed to \~10 cm depth and invertebrates and
organic matter were removed from stones with a brush. Samples were then preserved with 5% formaldehyde until laboratory analysis. In the laboratory, we split samples into coarse
(\>1 mm) and fine (\<1 mm but \>250 $\mu$m) fractions using nested sieves and then removed invertebrates from each fraction under a dissecting microscope (10--15 x magnification).
For particularly large samples, fine fractions were sub-sampled (1/2--1/16th) using a modified Folsom plankton splitter prior to removal of invertebrates. Subsamples were scaled to
the rest of the sample assuming similar abundance and body size distributions. Macroinvertebrates were identified to the lowest practical taxonomic level (usually genus) with
taxonomic keys [@peterson1977; @merritt2008; @andersen2013]. Taxon-specific abundance and biomass were scaled to a per meter basis by dividing by the Surber sampler area.

## Secondary Production

Daily secondary production of invertebrate taxa was calculated using the instantaneous growth rate method [IGR, @benke2017]. Growth rates were determined using taxon appropriate
approaches described in [@junker2020]. Briefly, growth rates of common taxa (e.g., Chironomidae spp., *Radix balthica*, etc.) were determined using *in situ* chambers [@huryn1986].
Multiple individuals (*n* = 5--15) within small size categories (\~1 mm length range) were photographed next to a field micrometer, placed into the stream within pre-conditioned
chambers for 7--15 days, after which they were again photographed. Individual lengths were measured from field pictures using image analysis software [@schindelin2012], and body
lengths were converted to mass (mg ash-free dry mass [AFDM]) using published length-mass regressions [@benke1999; @ogorman2012; @hannesdottir2013]. Growth rates (*g*, d^-1^) were
calculated by the changes in mean body size (*M*) over a given time interval (*t*) with the following equation:

$$g = log_e ( M_{t+\Delta t} / M_t) / \Delta t$$

Variability in growth rates was estimated by bootstrapping through repeated resampling of individual lengths with replacement (*n* = 1000). For taxa which exhibit synchronous growth
and development (e.g., Simuliidae spp., some Chironomidae spp., etc.), we examined temporal changes in length-frequency distributions and calculated growth rates and uncertainty
using a bootstrap technique similar to that described in Benke and Huryn [-@benke2017]. Individual Lengths were converted to mg AFDM using published length-mass regression cited
above and size-frequency histograms were visually inspected for directional changes in body size through time. For each date, size-frequency distributions were resampled with
replacement and growth rates estimated from equation 1. We prevented the calculation of negative growth rates by requiring $M_{t + \Delta t}$ \> $M_t$. If this condition was not met after 1e^4^ resamplings, a minimum growth rate of 0.001 was set. To estimate
growth rates of taxa for which growth could not be estimated empirically, we developed stream-specific growth rate models by constructing multivariate linear regressions of
empirical growth data against body size and temperature within each stream. To estimate uncertainty in production of each taxon, we used a bootstrapping technique that resampled
measured growth rates, in addition to abundance and size distributions from individual samples. For each iteration, size-specific growth rates were multiplied by mean
interval biomass for each size class and the number of days between sample dates to estimate size class-specific production. For each interval, size classes were summed for each
taxon to calculate total population-level production. Intervals were summed to estimate annual secondary production.

## Organic Matter Consumption Estimates

Organic matter fluxes through the community (g m^-2^ t^-1^) were calculated using the trophic basis of production method [TBP, @benke1980]. Taxon-specific secondary production estimates were combined with
diet proportions (see Supplemental Materials), diet-specific assimilation efficiencies, *AE~i~*, and assumed net production efficiencies, *NPE*, to estimate consumption of organic matter. For each food
category, *i*, diet proportions were multiplied by the gross growth efficiency ($GGE_{i} = AE_{i} * NPE$) to calculate the relative production attributable to each food
category. The relative production from each food type was then multiplied by the interval-level production and finally divided by $GGE_{i}$ to estimate consumption of organic
matter from each food category by a consumer [@benke1980]. Consumption was calculated for each taxon across sampling intervals (typically \~1 month). Total interval consumption was
calculated by summing across all taxa, while annual consumption was calculated by summing across all taxa and intervals. Variability in consumption estimates was estimated through
a Monte Carlo approach, wherein bootstrapped vectors of secondary production for each taxon (see *Secondary production* methods above) were resampled and consumption estimated with
the TBP method using modeled diet proportions (see *Diet analysis* in Supplemental Materials), diet-specific assimilation efficiencies, and net production efficiency. Variability in *AE~i~* was
incorporated by resampling values from beta distributions fit to median and 2.5% and 97.5% percentiles for each diet item: diatoms = 0.30 (95% percentile interval (PI): 0.24-0.36),
filamentous and green algae = 0.30 (95% PI: 0.24-0.36), cyanobacteria = 0.10 (95% PI: 0.08-0.12), amorphous detritus = 0.10 (95% PI: 0.08-0.12), vascular and non-vascular plants
(bryophytes) = 0.1 (95% PI: 0.08-0.12), and animal material = 0.7 (95% PI: 0.56-0.84)[@welch1968; @cross2007; @cross2011; @benke1980; @benke1997]. Variability in *NPE* was
incorporated by resampling values from an assumed beta distribution with median *NPE* = 0.45 (95% PI = 0.4-0.5). Beta distributions were fit using the 'get.beta.par()' function
within the *rriskDistributions* package [@belgorodski2017].

## Quantifying the distribution of food web fluxes

### Evenness Among consumers

To visualize and quantify how evenly OM fluxes were distributed among consumers within a stream, we constructed Lorenz curves [@lorenz1905] on rank ordered OM fluxes, such that in a community with $S$ species and the relative OM flux of species *i*, $p_i$, is ordered $p_1 \leq p_2 \leq ... p_S$. The Lorenz curve plots how a value, in this case OM flux, accumulates with increasing cumulative proportion of species. In a community with perfectly equal distribution of OM flux among species, the Lorenz curve is simply a straight diagonal line. Deviation from perfect equality was calculated as the Gini coefficient [@gini1921], normalized for differences in $S$ among streams, $G^*$ [@solomon1975; @chao2019]: 

$$ G^* = (2 \sum_{i = 1}^S ip_i -2)/(S-1)$$ 

where $G^*$ represents an index of relative evenness of OM fluxes bounded between zero and one--one representing a community with exactly equal proportion of total community OM flux for all species ($1/S$), and a value of zero where total community flux is attributed to a single species. 

### Distribution of OM fluxes in relation to species' traits

We predicted that warming would favor species with smaller body size and higher population turnover and therefore OM fluxes would be skewed towards small body size (*M*) and higher *P:B* across and within communities. To assess the potential effects of environmental filtered across communities, we explored the relationships between mean annual temperature ($^\circ$C) and mean population *M* and *P:B* of each community with bootstrapped linear regressions. Here, `r temperature_stats[['n_boot']]` values of population *M* or *P:B* were resampled with replacement for each species within each stream. The mean of all populations within a stream was calculated and a linear model was fit between *log~e~*-transformed *M* or *P:B* and mean annual temperature. Response variables *M* and *P:B* were transformed to meet the assumption of normally distributed residual variation.

To quantify how the distribution of organic matter fluxes were modified _**within**_ a community and how this modification was related to temperature, we assessed the extent to which the relative OM fluxes among consumers within a community were skewed towards populations with lower or higher relative *M* or *P:B*. To do this, we ordered species based on within-stream ranking of annual population traits (i.e., $M$, $P:B$) and then calculated a measure of skewness, $Sk_{flux}$, based on quartiles of the distribution of OM fluxes in relation to species traits as:

$$Sk_{flux} = f_{Q0.75} - 2f_{Q0.5} + f_{Q0.25}/ f_{Q0.75}-f_{Q0.25}$$

where, $f_{Qx}$, is the cumulative flux at some quantile, $Qx$, of the community trait distribution. We repeated this analysis for all bootstrapped estimates of OM flux in all communities. Skewness coefficients exist in the range [-1, 1], where -1 indicates OM fluxes are skewed perfectly away from a trait and 1 indicates higher relative flux is perfectly associated with higher trait values. To determine if $Sk_{flux}$ with population *M* and *P:B* was related to mean annual stream temperature, we use bootstrapped beta regression with a simple transformation to meet the assumptions of the model, $(Sk_{flux} + 1)/2$, thereby standardizing values between 0 and 1. Model coefficients were back-transformed to estimate effect sizes.

To assess how temperature may structure the skew of OM among populations within a community, we quantified how likely it was to observe such a skewed distribution in OM fluxes by random chance. Skewness in OM fluxes may arise through both ecological and random processes. Further, the feasible range of skewness values a community can take is inherently tied to the evenness of OM fluxes within a community. This dependence on evenness can make it difficult to determine the importance of random versus ecological processes on the distribution of OM fluxes in the community through comparison of raw skewness measures alone. Here, we predicted that species' $M$ and $P:B$ would be increasingly important traits structuring OM fluxes within a community and therefore warmer streams would exhibit highly skewed OM distributions that would be unlikely due to chance (i.e., 'non-random ordering'). In contrast, cooler streams would exhibit OM fluxes with skew values that are more likely due to random chance ('random ordering'), regardless of raw skewnness values, suggesting other traits govern the distribution of OM fluxes within communities. To accomplish this, we first had to account for statistical constraints that restrict the range of possible outcomes [\ i.e., feasible set, @haegeman2008; @diaz2021a], given the number of species and the relative distribution of OM fluxes within a community. The number of unique orderings of species increases to computationally intractable numbers very quickly (e.g., $S!$, 10 species ~3.6e^6^ unique orderings). Therefore, we chose to permute a random subset of each stream community's feasible set by randomly ordering species and calculating the skewness in the cumulative distribution of annual OM fluxes 100,000 times in each stream. The number of random orderings was chosen as a balance between characterizing the distribution of skewness values within each feasible set and computational and time constrains. This permuted set allowed us to calculate the probability of observing the empirical skewness, $Sk_{flux}$, in each stream compared to a random ordering given the distribution of relative OM flux. 

# Results

```{r load objects from cache, echo = FALSE, warning = FALSE, message=FALSE}
library(tidyverse)
 drake::loadd(flux_estimates)
 energy_demand = flux_estimates[["energy_demand"]]
 comm_energy_demand_summary = energy_demand %>%
    group_by(site, boot_id) %>% 
    dplyr::summarise(flux_mg_m_y = sum(flux_mg_m_y)) %>%
    ungroup %>% group_by(site) %>%
    dplyr::summarise(across(matches('flux'), list(mean = ~mean(.x, na.rm = TRUE),
                                                            quant2.5 = ~quantile(.x, 0.025, na.rm = TRUE),
                                                            quant25 = ~quantile(.x, 0.25, na.rm = TRUE),
                                                            quant50 = ~quantile(.x, 0.50, na.rm = TRUE),
                                                            quant75 = ~quantile(.x, 0.75, na.rm = TRUE),
                                                            quant97.5 = ~quantile(.x, 0.975, na.rm = TRUE)))) %>%
  bind_rows
  min_demand = comm_energy_demand_summary %>% dplyr::slice(which.min(flux_mg_m_y_mean))
  max_demand = comm_energy_demand_summary %>% dplyr::slice(which.max(flux_mg_m_y_mean))
  
drake::loadd(flux_summaries)
annual_comm_flux_summary = flux_summaries[["annual_comm_flux_summary"]]
min_flux = annual_comm_flux_summary %>% dplyr::slice(which.min(flux_mg_m_y_mean))
max_flux = annual_comm_flux_summary %>% dplyr::slice(which.max(flux_mg_m_y_mean))

drake::loadd(temperature_stats)

pb_spp_temp_coefs = temperature_stats[["pb_spp_temp_coefs"]]
m_spp_temp_coefs = temperature_stats[["m_spp_temp_coefs"]]

```

## Community organic matter fluxes

Annual community OM fluxes mirrored patterns of secondary production reported previously [@junker2020]. Organic matter flux to invertebrates varied ~`r round((max_flux$flux_mg_m_y_mean/min_flux$flux_mg_m_y_mean),0)`-fold among streams (mean [95% percentile interval (PI)]: `r round((min_flux$flux_mg_m_y_mean/1000), 1)`[`r round((min_flux$flux_mg_m_y_quant2.5/1000),1)` -- `r round((min_flux$flux_mg_m_y_quant97.5/1000),1)` to `r round((max_flux$flux_mg_m_y_mean/1000),1)` [`r round((max_flux$flux_mg_m_y_quant2.5/1000),1)` -- `r round((max_flux$flux_mg_m_y_quant97.5/1000),1)`] g AFDM $m^{-2} y^{-1}$) and was positively related to temperature (Figure 1A).

```{r diet import, echo = FALSE, include = TRUE, message=FALSE, warning = FALSE}
drake::loadd(modeled_diets)
diet_predictions_site = modeled_diets[["diet_predictions"]] %>%
   dplyr::mutate(site = factor(site, levels = names(stream_order_list))) %>%
    group_by(site, diet_item) %>%
    dplyr::summarise(across(rel_area, list(mean = ~mean(.x, na.rm = TRUE),
                                                            quant2.5 = ~quantile(.x, 0.025, na.rm = TRUE),
                                                            quant25 = ~quantile(.x, 0.25, na.rm = TRUE),
                                                            quant50 = ~quantile(.x, 0.50, na.rm = TRUE),
                                                            quant75 = ~quantile(.x, 0.75, na.rm = TRUE),
                                                            quant97.5 = ~quantile(.x, 0.975, na.rm = TRUE))))

diet_predictions_item = modeled_diets[["diet_predictions"]] %>%
   dplyr::mutate(site = factor(site, levels = names(stream_order_list))) %>%
    group_by(diet_item) %>%
    dplyr::summarise(across(rel_area, list(mean = ~mean(.x, na.rm = TRUE),
                                                            quant2.5 = ~quantile(.x, 0.025, na.rm = TRUE),
                                                            quant25 = ~quantile(.x, 0.25, na.rm = TRUE),
                                                            quant50 = ~quantile(.x, 0.50, na.rm = TRUE),
                                                            quant75 = ~quantile(.x, 0.75, na.rm = TRUE),
                                                            quant97.5 = ~quantile(.x, 0.975, na.rm = TRUE))))

drake::loadd(diet_similarity)
min_within_overlap = diet_similarity[['within_overlap_summ']] %>% dplyr::slice_min(meanoverlap_mean)
max_within_overlap = diet_similarity[['within_overlap_summ']] %>% dplyr::slice_max(meanoverlap_mean)

# min_among_overlap = diet_similarity[[]]

among_overlap_mean = mean(diet_similarity[['among_overlap_mean']], na.rm = TRUE)
among_overlap_quant2.5 = quantile(diet_similarity[['among_overlap_mean']], 0.025, na.rm = TRUE)
among_overlap_quant97.5 = quantile(diet_similarity[['among_overlap_mean']], 0.975, na.rm = TRUE)

```

Differences in OM flux among streams driven by variation in total energy deman rather than composition of consumed resources, as consumer diets were highly similar among streams (Figure S1). Diets were dominated by diatoms (`r diet_predictions_item %>% dplyr::filter(diet_item == "diatom") %>% select(contains('mean')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`%; `r diet_predictions_item %>% dplyr::filter(diet_item == "diatom") %>% select(contains('quant2.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`--`r diet_predictions_item %>% dplyr::filter(diet_item == "diatom") %>% select(contains('quant97.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`; 95% PI), amorphous detritus (`r diet_predictions_item %>% dplyr::filter(diet_item == "amorphous_detritus") %>% select(contains('mean')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`%; `r diet_predictions_item %>% dplyr::filter(diet_item == "amorphous_detritus") %>% select(contains('quant2.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`--`r diet_predictions_item %>% dplyr::filter(diet_item == "amorphous_detritus") %>% select(contains('quant97.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`; 95% PI), and green algae (`r diet_predictions_item %>% dplyr::filter(diet_item == "green_algae") %>% select(contains('mean')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`%; `r diet_predictions_item %>% dplyr::filter(diet_item == "green_algae") %>% select(contains('quant2.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`--`r diet_predictions_item %>% dplyr::filter(diet_item == "green_algae") %>% select(contains('quant97.5')) %>% dplyr::mutate(across(.fns = ~.x*100)) %>% round(1)`; 95% PI). Within streams, diet overlap ranged from `r min_within_overlap %>% dplyr::select(meanoverlap_mean) %>% round(2)*100`% (`r round(min_within_overlap$meanoverlap_quant2.5,2)*100` -- `r round(min_within_overlap$meanoverlap_quant97.5,2)*100`%) to `r max_within_overlap %>% dplyr::select(meanoverlap_mean) %>% round(2)`% (`r round(max_within_overlap$meanoverlap_quant2.5,2)*100` -- `r round(max_within_overlap$meanoverlap_quant97.5,2)*100`%) among invertebrate taxa. Among streams, diet overlap was similarly high with a mean overlap of `r round(among_overlap_mean,2)*100`% (`r round(among_overlap_quant2.5,2)*100` -- `r round(among_overlap_quant97.5,2)*100`%; 95% PI). Diet similarities based on pairwise comparisons among streams showed little difference and no clear relationship with temperature.

```{r species richness, echo = FALSE, warning=FALSE, message=FALSE}
spp_richness = energy_demand %>% group_by(site) %>% dplyr::summarise(taxon_n = n_distinct(taxon))

drake::loadd(gini_analysis)
gini_summary = gini_analysis[["stream_gini_summary"]] %>% set_names(make.names(names(.)))

```

```{r spp flux summaries, echo = FALSE, warning=FALSE, message=FALSE}
drake::loadd(spp_rankings_summary)
spp_flux_summary = spp_rankings_summary[["prod_spp_rank"]]
select_dom = function(x){
  x= x[which(!is.na(x$taxon)),]
  x = x %>% dplyr::mutate(tot_n = max(prod_ann_rank, na.rm = TRUE))
  if(sum(x$rel_flux >= 0.15) > 1){
    y = x[which(x$rel_flux >= 0.15),]
    } else{
      y = x[which(x$prod_ann_rank >= (max(x$prod_ann_rank)-1)),]
   }
  return(y)
}

spp_dominance = spp_flux_summary %>% named_group_split(site) %>% map(.,~select_dom(.x)) %>% bind_rows(.id = 'site') %>% 
  group_by(site) %>%
  dplyr::summarise(n_dom = n(), 
                   tot_n = unique(tot_n),
                   dom_flux = 1-min(rel_flux, na.rm = TRUE), 
                   dom_spp = 1-min(rel_spp))

n_dom_min = spp_dominance %>% dplyr::slice_min(n_dom)
n_dom_max = spp_dominance %>% dplyr::slice_max(n_dom)

perc_dom_min = spp_dominance %>% dplyr::slice(which.min(dom_spp))
perc_dom_max = spp_dominance %>% dplyr::slice(which.max(dom_spp))


```

## Evenness of organic matter fluxes 

In general, OM fluxes were unevenly distributed among taxa (Gini inequality coefficients ranged from `r gini_summary %>% select('Non.normalized.Gini_mean') %>% min %>% round(2)` [`r gini_summary %>% data.frame %>% dplyr::slice_min(Non.normalized.Gini_mean) %>% select(Non.normalized.Gini_quant2.5) %>% round(2)` -- `r gini_summary %>% data.frame %>% dplyr::slice_min(Non.normalized.Gini_mean) %>%  select('Non.normalized.Gini_quant97.5') %>% round(2)` 95% PI] to `r gini_summary %>% data.frame %>% dplyr::slice_max(Non.normalized.Gini_mean) %>%  select('Non.normalized.Gini_mean') %>% round(2)` [`r gini_summary %>% data.frame %>% dplyr::slice_max(Non.normalized.Gini_mean) %>% select('Non.normalized.Gini_quant2.5') %>% round(2)` -- `r gini_summary %>% data.frame %>% dplyr::slice_max(Non.normalized.Gini_mean) %>% select('Non.normalized.Gini_quant97.5') %>% round(2)` 95% PI; Table S1] and were dominated by insects in the families Simuliidae and Chironomidae, pulmonated snails (*Radix balthica*), and oligochaete worms (Figure 2A & B; Figure S2). In an absolute sense, and ~85% of total OM flux was contributed by `r n_dom_min$n_dom` and `r n_dom_max$n_dom` taxa, which comprised only `r round(perc_dom_min$dom_spp*100,0)`% to `r round(perc_dom_max$dom_spp*100,0)`% of total taxon richness. Although differences in evenness among streams were partially attributed to variation in taxon richness (range: `r spp_richness %>% select(taxon_n) %>% min` to `r spp_richness %>% select(taxon_n) %>% max`), fluxes wre still highly uneve after accounting for differences in richness (i.e., similar 'Normalized' Gini coefficients, Table S1). As average stream temperature increased, OM fluxes shifted from dominance by Simuliidae in the coolest stream to Chironomidae and *R. balthica* at moderate temperatures. In the warmest stream, where maximum temperatures approach ~40$^\circ$C, taxon richness was lowest and OM fluxes were dominated by oligochaete worms in the family Naididae, the chironomid *Cricotpous sylvestris*, and *R. balthica*. Among stream differences in evenness and dominance of OM fluxes were not related to temperature (). 

<!-- \newpage -->

```{r trait df, echo = FALSE, warning = FALSE, message = FALSE}
drake::loadd(spp_traitsVtemp)
ann_spp_summ = spp_traitsVtemp[['ann_spp_summ']]

drake::loadd(gini_analysis)
```

```{r trait v temp, echo=FALSE, warning=FALSE, message=FALSE, fig.width=7, fig.height=5, dpi = 450, fig.cap="Figure 1. (A) Total organic matter flux (g AFDM m^-2^ y^-1^) increased with increasing mean annual temperature. Warming stream temperatures also led to (B) a decrease in mean population body size (*M*, mg ind^1^) and (C) an increase in mean population biomass turnover rate (*P:B*, y^-1^)."}

drake::loadd(spp_traitsVtemp)
grid.draw(spp_traitsVtemp[['fig1_plot']])

 # drake::loadd(spp_trait_histograms)
# grid.draw(spp_trait_histograms)

```

## Organic matter fluxes in relation to body size and biomass turnover rate

```{r trait summary, echo = FALSE, warning=FALSE, message=FALSE}
drake::loadd(spp_rankings_summary)
pb_summ = spp_rankings_summary[["PB_spp_rank"]] %>% na.omit %>% group_by(site) %>% dplyr::summarise(across(matches("pb.*mean"), ~mean(.x,na.rm = TRUE)))

m_summ = spp_rankings_summary[["M_spp_rank"]] %>% na.omit %>% group_by(site) %>% dplyr::summarise(across(matches(".*ind_mean"), ~mean(.x,na.rm = TRUE)))

M_temp_coefs = temperature_stats[["m_spp_temp_coefs"]]
# M_temp_coefs = temperature_stats[["M_temp_coefs"]]
M_temp_coef_mean = round((exp(mean(M_temp_coefs, na.rm = TRUE)) -1)*100,1)
M_temp_coef_quant2.5 = round((exp(quantile(M_temp_coefs, 0.025, na.rm = TRUE))-1)*100,1)
M_temp_coef_quant97.5 = round((exp(quantile(M_temp_coefs, 0.975, na.rm = TRUE))-1)*100,1)

pb_temp_coefs = temperature_stats[["pb_spp_temp_coefs"]] 
# pb_temp_coefs = temperature_stats[["pb_temp_coefs"]]
pb_temp_coef_mean = round((exp(mean(pb_temp_coefs, na.rm = TRUE))-1)*100,1)
pb_temp_coef_quant2.5 = round((exp(quantile(pb_temp_coefs, 0.025, na.rm = TRUE))-1)*100,1)
pb_temp_coef_quant97.5 = round((exp(quantile(pb_temp_coefs, 0.975, na.rm = TRUE))-1)*100,1)

backtransform_skew = function(x,...){
  x * 2 - 1
}
# analyze skewness with temperature
M_skew_temp_coefs = backtransform_skew(plogis(temperature_stats[["M_skew_temp_coefs"]]$b_tempC_stand))
M_skew_temp_coef_mean = round(mean(M_skew_temp_coefs, na.rm = TRUE), 2)
M_skew_temp_coef_median = round(mean(M_skew_temp_coefs, na.rm = TRUE), 2)
M_skew_temp_coef_quant2.5 = round(quantile(M_skew_temp_coefs, 0.025, na.rm = TRUE),2)
M_skew_temp_coef_quant97.5 = round(quantile(M_skew_temp_coefs, 0.975, na.rm = TRUE),2)

pb_skew_temp_coefs = backtransform_skew(plogis(temperature_stats[["pb_skew_temp_coefs"]]$b_tempC_stand))
pb_skew_temp_coef_mean = round(mean(pb_skew_temp_coefs, na.rm = TRUE),2)
pb_skew_temp_coef_quant2.5 = round(quantile(pb_skew_temp_coefs, 0.025, na.rm = TRUE),2)
pb_skew_temp_coef_quant97.5 = round(quantile(pb_skew_temp_coefs, 0.975, na.rm = TRUE),2)

drake::loadd(skew_analysis)

pb_skew_summ = skew_analysis[["pb_skew_summ"]]

m_skew_summ = skew_analysis[["M_skew_summ"]]

```

Across stream communities, average population body size (*M* [mg AFDM ind^-1^]) decreased and average population biomass turnover rate (*P:B* [y^-1^]), increased with increasing temperature (Figure 1B, C). Average *M* decreased from `r ann_spp_summ %>% dplyr::select(M_mg_ind_mean) %>% max %>% round(2)` mg AFDM ind^-1^ (`r ann_spp_summ %>% dplyr::slice_max(M_mg_ind_mean) %>% dplyr::select(M_mg_ind_quant2.5) %>% round(2)` -- `r ann_spp_summ %>% dplyr::slice_max(M_mg_ind_mean) %>% dplyr::select(M_mg_ind_quant97.5) %>% round(2)`; 95% PI) in the coldest stream to `r ann_spp_summ %>% dplyr::select(M_mg_ind_mean) %>% min %>% round(2)`0 mg AFDM ind^-1^ (`r ann_spp_summ %>% dplyr::slice_min(M_mg_ind_mean) %>% dplyr::select(M_mg_ind_quant2.5) %>% round(2)` -- `r ann_spp_summ %>% dplyr::slice_min(M_mg_ind_mean) %>% dplyr::select(M_mg_ind_quant97.5) %>% round(2)`; 95% PI) in the warmest stream, corresponding to an `r ((exp(mean(m_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(1)`% (`r ((exp(quantile(m_spp_temp_coefs,0.025, na.rm = TRUE)) - 1)*100) %>% round(1)` -- `r ((exp(quantile(m_spp_temp_coefs,0.975, na.rm = TRUE)) - 1)*100) %>% round(1)`; 95% PI) decrease in mean body size for every 1$^\circ$C increase in temperature (Figure 1B). Average population *P:B* ratio increased from `r ann_spp_summ %>% dplyr::select(pb_y_mean) %>% min %>% round(2)` y^-1^ (`r ann_spp_summ %>% dplyr::slice_min(pb_y_mean) %>% dplyr::select(pb_y_quant2.5) %>% round(2)` -- `r ann_spp_summ %>% dplyr::slice_min(pb_y_mean) %>% dplyr::select(pb_y_quant97.5) %>% round(2)`; 95% PI) in the coldest stream to `r ann_spp_summ %>% dplyr::select(pb_y_mean) %>% max %>% round(2)` y^-1^ (`r ann_spp_summ %>% dplyr::slice_max(pb_y_mean) %>% dplyr::select(pb_y_quant2.5) %>% round(2)` -- `r ann_spp_summ %>% dplyr::slice_max(pb_y_mean) %>% dplyr::select(M_mg_ind_quant97.5) %>% round(2)`; 95% PI) in the warmest stream corresponding to a `r ((exp(mean(pb_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(2)`% (`r ((exp(quantile(pb_spp_temp_coefs,0.025, na.rm = TRUE)) - 1)*100) %>% round(2)`--`r ((exp(quantile(pb_spp_temp_coefs,0.975, na.rm = TRUE)) - 1)*100) %>% round(2)`; 95% PI) increase in *P:B* ratio for every 1$^\circ$C increase (Figure 1C).
 
```{r figure 2, echo = FALSE, warning = FALSE, message = FALSE, fig.width=7.5, fig.height=8, dpi = 450, fig.cap="Figure 2. (A) Relative contribution (log_10_%) of different taxa to OM flux in each stream; colors correspond to mean annual temperature shown in the legend; (B) rank ordered organic matter flux (log_e_(mg AFDM m^-2^ y^-1^) by taxon. See supporting materials for the full key of taxonomic abbreviations."}

drake::loadd(annual_spp_flux_fig)
drake::loadd(spp_flux_dist)
gridExtra::grid.arrange( spp_flux_dist,annual_spp_flux_fig, ncol = 2, layout_matrix = cbind(1,1,1,1,2,2,2))
```

Within stream communities, OM fluxes skewed towards taxa with larger body sizes (positive skew), smaller body sizes (negative skew), and neutrally with respect to body size (Figure 3A). Skew estimates with body size (skew range: `r m_skew_summ %>% slice_min(M_mg_ind_skew_median) %>% select(M_mg_ind_skew_median)%>% round(2)` to `r m_skew_summ %>% slice_max(M_mg_ind_skew_median) %>% select(M_mg_ind_skew_median) %>% round(2)`; Figure 3B). Skew estimates of OM fluxes in relation to body size showed little association with stream temperature except in the warmest stream, where fluxes were heavily skewed toward small-bodied taxa. Similarly, skew in OM fluxes in relations to *P:B* ratios varied among streams, ranging from `r pb_skew_summ %>% slice_min(pb_y_skew_median) %>% select(pb_y_skew_median) %>% round(2)` to `r pb_skew_summ %>% slice_max(pb_y_skew_median) %>% select(pb_y_skew_median) %>% round(2)`. In this case, OM fluxes to consumers skewed increasingly toward higher turnover (*P:B*) taxa with increasing temperature (Figure 4A, B).

```{r M lorenz analysis, echo =FALSE, warning=FALSE, message=FALSE, fig.width=5, fig.height=4, dpi = 450, fig.cap="Figure 3. (A) Lorenz curves showing cumulative relative organic matter flux among taxa with increasing body size (from left to right; *M*, mg AFDM ind^-1^). The solid line 1:1 line from the origin represents the line of perfect equality. Distributions near this line suggest minimal structuring of OM fluxes in relation to body size. The dotted line allows for visualization of skewness in OM fluxes based on its intersection with the empirical lorenz curve. (B) Empirical estimates of body size-related OM flux skewness in relation to stream temperature. (C) The probability of observing these skewness values when compared to a random (i.e. s) ordering."}

drake::loadd(M_lorenz_skew_fig)
grid.draw(M_lorenz_skew_fig)

```

```{r probs coefs, echo=FALSE, warning=FALSE, message=FALSE}
m_prob_temp_coef = temperature_stats[["m_probs_temp_coefs"]]$b_tempC_stand
m_prob_temp_median = median(m_prob_temp_coef, na.rm =TRUE)
m_prob_temp_quant2.5 = quantile(m_prob_temp_coef, 0.025,na.rm = TRUE)
m_prob_temp_quant97.5 = quantile(m_prob_temp_coef,0.975, na.rm =TRUE)

pb_prob_temp_coef = temperature_stats[["pb_probs_temp_coefs"]]$b_tempC_stand
pb_prob_temp_median = median(pb_prob_temp_coef, na.rm =TRUE)
pb_prob_temp_quant2.5 = quantile(pb_prob_temp_coef, 0.025,na.rm = TRUE)
pb_prob_temp_quant97.5 = quantile(pb_prob_temp_coef,0.975, na.rm =TRUE)

```

We compared our empirical skew estimates (i.e., $Sk_{flux}$) absed on ordered data (i.e., ordered from small to large *M* or low to high *P:B* ratios; Figure 3B and Figure 4B) to skew estimates based on randomly sorted data to detect whether OM fluxes through smaller and higher *P:B* taxa were based on random selection (i.e., stochastic) or were truly based on these traits. The probability of observing a similar or more extreme skew of OM fluxes in relation to body size was variable among streams and ranged from `r m_skew_summ %>% slice_min(M_skew_prob_mean) %>% select(matches("M.*prob_mean")) %>% round(2)` (`r m_skew_summ %>% slice_min(M_skew_prob_mean) %>% select(matches("M.*prob_quant2.5")) %>% round(2)`--`r m_skew_summ %>% slice_min(M_skew_prob_mean) %>% select(matches("M.*prob_quant97.5")) %>% round(2)`; 95% PI) to `r m_skew_summ %>% slice_max(M_skew_prob_mean) %>% select(matches("M.*prob_mean")) %>% round(2)` (`r m_skew_summ %>% slice_max(M_skew_prob_mean) %>% select(matches("M.*prob_quant2.5")) %>% round(2)`--`r m_skew_summ %>% slice_max(M_skew_prob_mean) %>% select(matches("M.*prob_quant97.5")) %>% round(2)`; 95% PI); there was a very weak positive association between this probability and temperature (Figure 3C). In contrast, the probability of a similarly or more extreme skew in relation to *P:B* ratios ranged from `r pb_skew_summ %>% slice_min(pb_skew_prob_mean) %>% select(matches("pb.*prob_mean")) %>% round(2)` (`r pb_skew_summ %>% slice_min(pb_skew_prob_mean) %>% select(matches("pb.*prob_quant2.5")) %>% round(2)` -- `r pb_skew_summ %>% slice_min(pb_skew_prob_mean) %>% select(matches("pb.*prob_quant97.5")) %>% round(2)`; 95% PI) to `r pb_skew_summ %>% slice_max(pb_skew_prob_mean) %>% select(matches("pb.*prob_mean")) %>% round(2)` (`r pb_skew_summ %>% slice_max(pb_skew_prob_mean) %>% select(matches("pb.*prob_quant2.5")) %>% round(2)` -- `r pb_skew_summ %>% slice_max(pb_skew_prob_mean) %>% select(matches("pb.*prob_quant97.5")) %>% round(2)`; 95% PI, Figure 4C) and in this case there was a clear trend towards a more structured OM flux distribution--i.e., favoring fluxes through high *P:B* taxa--at warmer temperatures. The likelihood of elevated fluxes among high *P:B* taxa became much more likely with warming, and the probability of random ordering decreased `r round(pb_prob_temp_median, 3)*100`% (`r round(pb_prob_temp_quant2.5,3)*100`% -- `r round(pb_prob_temp_quant97.5,3)*100`%; 95% PI) for every 1$^\circ$C increase in temperature (Figure 4C).

```{r skew prob temp, echo = FALSE, warning=FALSE, message=FALSE, fig.width=5, fig.height=4, dpi = 450, fig.cap="Figure 4. (A) Lorenz curves showing cumulative relative organic matter flux among taxa with increasing *P:B* ratio (from left to right; y^-1^). The solid line 1:1 line from the origin represents the line of perfect equality. Distributions near this line suggest minimal structuring of OM fluxes in relation to *P:B* ratio. The dotted line allows for visualization of skewness in OM fluxes based on its intersection with the empirical lorenz curve. (B) Empirical estimates of *P:B*-related OM flux skewness in relation to stream temperature. (C) The probability of observing these skewness values when compared to a random (i.e. stochastic) ordering." }

drake::loadd(PB_lorenz_skew_fig)
grid.draw(PB_lorenz_skew_fig)
```

# Discussion

Rising global temperatures are altering the pathways of energy and material flow across and within ecosystems with potential consequences for the services they provide. While a growing body of theoretical and empirical study has enhanced our knowledge of temperature-mediated changes to ecosystems [\ e.g., @oconnor2009], general patterns are uncertain and empirical studies often idiosyncratic [@zhang2017; @nelson2017]---especially at higher levels of organizations such as communities and food webs [@walther2002; @woodward2010]. Here, we document shifts in the pathways of material flow across a wide natural temperature gradient and show that increasing temperatures were associated with reductions in mean population body size and increases in mean population *P:B* across stream consumer communities. Further, increasing temperature also systematically skewed OM fluxes *within* communities such that, food web fluxes were increasingly skewed towards  quick turnover populations at warmer temperatures. Lastly, there was evidence that the distribution of fluxes within communities was non-randomly organized, especially at moderate to warm temperatures and in relation to population *P:B*, suggesting that environmental filtering is especially important in community assembly of warm communities--governing both the traits of species present and the relative distribution of energy and materials fluxes among species. This tendency for fluxes to be dominated by relatively higher turnover populations at warmer temperatures and this organization to be increasingly non-random, suggests the speeding up of energy and material fluxes through ecosystems in both an absolute and relative sense may be a general effect of increasing temperature.

Reductions in organism body size with warming has been deemed a "universal" response to warming [@daufresne2009; @gardner2011; @uszko2022]. We observed a clear decrease in the average individual body size of populations from cool to warm communities (Figure 1B), corresponding to ~`r ((exp(mean(m_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(1)`% decline in the mass of individuals for every 1$^\circ$C increase in temperature. While this change represents a community-level shift, the magnitude of change is consistent with recent work on the effects of warming on organism body size across broad taxonomic groups [@deutsch2022]. This reduction in body size with increasing temperature contrasts results from previous whole-ecosystem warming experiments which observed shifts in community biomass and productivity from smaller to larger organisms following a 3$^\circ$C increase in temperature [@nelson2017; @nelson2017a]. Our results also counter observational studies in this system that have shown no consistent change in body size within diatom communities at either the population- or community-scale [@adams2013]. These contrasting results are consistent with deviations from the "universal" response observed across taxonomic groups [e.g., diatoms, @adams2013; invertebrates @zeuss2017; birds @geist1987; @riemer2018; fish @rypel2014]. Explanations for these deviations vary [@ohlberger2013], some highlight additional processes such as competition and predation [@delong2014], while others propose alternative models of organism body size optimization, such as the balance of resource supply and energy demand [e.g., @kozlowski2004; @delong2012a]. Crucially, these alternative models highlight the trade-off between asymptotic body size and metabolic demand [@delong2012a] that can shape life history patterns [\ i.e., voltinism, @zeuss2017; @nelson2020b; lifespan, @munch2009]. Considering the connections between organism body size and many other ecological attributes [@peters1983], reductions in body size with increasing temperatures could have broad implications for ecosystem dynamics with a changing climate [@gibert2019a].

Warmer ecosystems exhibited higher rates of material flux in both an absolute and relative sense. At the community level, we observed a ~`r ((exp(mean(pb_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(1)`% increase in the mean biomass turnover rate (*P:B*; y^-1^). Temperature has long been recognized as an important driver of ecological rates [@gillooly2001] and the increase in biomass turnover among communities is likely attributed to the thermodynamic effect of temperature--in part. Biomass turnover rate is also tightly tied to organism body size [@brown2004; @huryn2007] suggesting that temperature may influence the distribution of *P:B*s both directly through its effects on metabolic rates and indirectly by inducing reductions in organism body size. The increase in *P:B* we observed across communities was a similar relative magnitude as the reduction in body size (i.e., +`r ((exp(mean(pb_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(1)`% vs -`r ((exp(mean(m_spp_temp_coefs, na.rm = TRUE)) - 1)*100) %>% round(1)`%, respectively), providing equivocal evidence of the presence and/or importance of this interaction from this broad view. Despite this, the influence of this interaction between the direct and indirect effect of temperature on ecological patterns in increasingly recognized. For example, the effects of temperature on population carrying capacity appear to deviate from metabolic scaling predictions until the effects of concurrent changes to organism body size are taken into account [@bernhardt2018]. Further, there is growing evidence that the interactive effects warming-induced changes to metabolic rates and body size distributions have important implications for the structure and functioning of food webs at higher temperatures [@sentis2017; @bideault2019; @gibert2019a] and may reflect shifting selection for species traits.

Temperature was also an important modifier of the relative performance of species and distribution of OM fluxes *within* communities. In addition to the observed decrease in mean body size and increase in biomass turnover rates across communities, species' OM fluxes exhibited non-random patterning along species' trait axes. Regarding body size, the pattern was equivocal. In the coldest and warmest streams, we saw a strong skew in material fluxes towards larger and smaller species, respectively. However, at more moderate temperatures (~6--17$^\circ$C), this pattern was not apparent. On the other hand, we observed a clearer relationship between the skewness of OM fluxes in relation to biomass turnover with increasing temperatures. Fluxes became more skewed and less random in relation to population *P:B* at warmer temperatures (Figure 4B & C). The seemingly weak within community patterns with body size and much clearer patterns with *P:B* present a potentially interesting insight into the more proximate processes by which temperature alters ecosystem structure and function. For example, despite the general trend of reduced body sizes at higher temperature [e.g., @daufresne2009; @gardner2011; @uszko2022], there is a lack evidence for persistent evolutionary selection within populations for smaller body sizes with warming [@siepielski2019]. However, warming-induced body size reductions may act as a stabilizing process in consumer-resource interactions through reduced consumer:resource biomass ratios [@osmond2017; @gilbert2014; @sentis2017] and reductions in consumer growth rates relative to resource supply [@kozlowski2004; @delong2012a; @mccann2011]. 

Therefore, the general response of reduced body size with warming or latitudinal temperature gradients may, in fact, mask the true constraints imparted by food web dynamics because of the correlation between body size and other biological traits (e.g., growth rate, mortality rate, lifespan, biomass turnover rate, etc.). In high latitude light-driven systems, such as those here, larger and/or slower populations may destabilize consumer-resource dynamics further through more extreme seasonal autocorrelation of resource growth [@greyson-gaito2022], suggesting a connection between warming responses and a more general food web dynamic of increased relative rates of resource supply and consumer demand [\ e.g., paradox of enrichment, @mccann2011]. The importance of this dynamic may be under-appreciated in high-latitude ecosystems especially [@mcmeans2020] where warming is beginning to decouple light regimes and the timing of temperature-driven metabolic demands [@huryn2019a; @mcmeans2015] likely driving future changes to biodiversity of these systems.

Temperature was not clearly associated with the broad biodiversity metrics of species richness or evenness/dominance of OM fluxes. We observed no clear decrease in species richness with increasing temperature found in other works [@petchey1999] beyond the warmest stream having the fewest species. However, variability in the taxonomic resolution among groups precludes a more robust analysis of any richness effects. Still, generally OM fluxes were unevenly distributed among consumers. Given the systematic unevenness in the distribution of individuals among species [@diaz2021a], it may not be surprising that this carries over into energy and material fluxes. Interestingly, however, we found important structure in the unevenness of OM fluxes. Organic matter fluxes were increasingly skewed towards high *P:B* populations within warmer streams and this pattern was unlikely related to chance (Figure 4C), suggesting temperature may become an increasingly important environmental filter of community assembly and species relative performance. That the relative distribution was of OM fluxes was unlikely due to chance reduces that likelihood this pattern could be attributable to demographic stochasticity of consumers. This counters recent hypotheses integrating the metabolic theory of ecology [@brown2004] and neutral theory [@hubbell2001] that suggest neutral processes should be more important at higher temperatures [@saito2021]. The extent to which the patterns we observe here--i.e., the apparent increased importance of environmental/niche filtering at higher temperature--represent general patterns or results from the specific context of this "natural laboratory" [@ogorman2014] remains an open question.

Here, we documented the important structuring role of temperature in community assembly and the relative distribution of material fluxes across and within streams of a natural temperature gradient. Higher temperatures were associated with increased total flux through the food web as well as reductions in average population body size and increases in population biomass turnover. Further, biomass turnover rate was an increasingly important structuring trait at warmer temperatures, more so than organism body size. Yet, our results give support that warming may reduce organism size and also 'speed up' ecosystem dynamics in both an absolute and relative sense. These changes have important implications for the maintenance of biodiversity as well as for the connections between biodiversity and the magnitude and stability of energy and material cycling in ecosystems in a warming world.

# Acknowledgements

We are grateful to Sigurður Guðjonsson, Guðni Guðbergsson, and the staff at the Veiðimlastofnun for providing laboratory space and logistical support. We are also grateful to Sveinbj€orn Steinþorsson at the University of Iceland for super-jeep transport to our field sites during the winter. We thank Lauren David, David Hernandez, Amanda Keasberry, Elena Nava, Camille Perrett, Jackie Pitts, Friðþjófur Árnason, Liliana García, Ragnahildur Magnúsdottír, Ryan McClure, Vija Pelekis, Adam Toomey, Chau Tran, Brooke Weigel, Tanner Williamson and many undergraduate workers for field and laboratory help. Jeff Wesner and Abe Kanz generously provided R code and discussions on modeling diet proportions. This study was supported by the National Science Foundation (DEB-0949774 and DEB-1354624 to JPB and ADH and DEB-0949726 to WFC). 

# References

<div id="refs"></div>

\newpage

# Appendix

## Appendix 1

### Diet analysis

Macroinvertebrate diets were quantified for dominant taxa in each stream. We focused on numerically abundant taxa and/or taxa with relatively
high annual production. A minimum of five individuals were selected from samples, and, when possible included individuals of different size classes to account for ontogenetic
shifts in diet. We included individuals from different seasons to capture concurrent ontogenetic and seasonal changes. For small-bodied taxa, we combined multiple individuals (*n*
= 3--5) to ensure samples contained enough material for quantification. We used methods outlined in Rosi-Marshall [-@rosi-marshall2016] to remove gut tracts and prepare gut contents for quantification. Briefly, we removed the foregut from each individual or collection of individuals and sonicated contents in water for 30 seconds. Gut content slurries were filtered onto gridded nitrocellulose membrane filters (Metricel GN-6, 25 mm, 0.45 $\mu$m pore size; Gelman Sciences, Ann Arbor, MI, USA), dried at 60 $^\circ$C for 15 min, placed on a microscope slide, cleared with Type B immersion oil, and covered with a cover slip. We took 5--10 random photographs under 200--400x magnification, depending on the density of particles, using a digital camera mounted on a compound microscope. From these photographs we identified all particles within each field and measured the relative area of particles using image analysis software [@schindelin2012]. We classified particles into six categories: diatoms, green and filamentous algae, cyanobacteria, amorphous detritus, vascular and non-vascular plants (e.g., bryophytes), and animal material and then calculated the proportion of each food category in the gut by dividing their summed area by the total area of all particles. Gut contents of many predators were empty or contained unidentifiable, macerated prey. For these taxa, we assumed 100% animal material.

To estimate variability in diet compositions and to impute missing values for non-dominant, yet present, taxa, we modeled the diet proportions within each stream using a hierarchical multivariate model [@fordyce2011; @coblentz2017]. Here, the diet of a consumer population, *i*, in stream, *j*, is a multinomial vector,$\overrightarrow{y_{ij}}$, of
$$\overrightarrow{y_{ij}} \sim Multinomial(\overrightarrow{p_{ij}}, n_{ij})$$ $$\overrightarrow{p_i} \sim Dirichlet(\overrightarrow{q_i} \times  \alpha) $$ where, $\overrightarrow{p_i}$, is
a vector of consumer diet proportions, $\overrightarrow{q_i}$ is a vector of the population's diet proportions and $\alpha$ is a concentration parameter of the Dirichlet process.
We used uniform priors for $\overrightarrow{q_i}$ and $\alpha$, $$\overrightarrow{q_i} \sim Dirichlet(\overrightarrow{\textbf{1}})$$ $$\alpha \sim Uniform(0,\textit{c})$$ where,
$\overrightarrow{\textbf{1}}$ is a vector of ones the same length of basal resource types and $\textit{c}$ is the assumed concentration value. Models were fit in Stan with the 'brms' package in R [@burkner2017]. For non-dominant taxa, diet proportions were imputed
from the hierarchical model by resampling from posterior distributions. Importantly, this process allowed to maintain the hierarchical structure of the data when imputing missing values.

From modeled diet compositions, we estimated trophic redundancy within and across stream food webs by calculating proportional similarities [\ *PS*, @whittaker1952] among modeled diet estimates. Proportional similarities were calculated as:

$$ PS = 1 - 0.5 \sum_{j=1}^S|p_{x,i} - p_{y,i}|$$

where, *p~x,i~* is the proportion of food resource *i* in the diet of taxon *x*, *p~y,i~* is the proportion of food resource *i* in the diet of taxon *y*, and there are *S* food categories. Proportional similarity was calculated across all taxa within a stream based on modeled diet contributions from each taxon. To calculate *PS* among streams we sampled 1000 estimates of the mean stream-level diet proportions for each stream and calculated *PS* for each. 

 ```{r diet figure, echo = FALSE, warning=FALSE, message=FALSE,  dpi = 450, fig.cap="Figure S1. Modeled diet proportions of consumer communities across the temperature gradient."}

 drake::loadd(prelim_diet_figures)
 prelim_diet_figures

 ```

\newpage

## Appendix 2

```{r GINI table, echo = FALSE, warning=FALSE, message=FALSE}
tab1_caption = "Table 1. Evenness of organic matter fluxes among consumers within a stream community measured by the Gini index, both raw (\\'non-normalized\\') and \\'normalized\\' for consumer richness"
gini_analysis[["stream_gini_summary"]] %>% 
   dplyr::mutate(across(where(is.numeric),.fns = ~signif(.,2))) %>% 
   dplyr::mutate("Non-normalized Gini" = paste0(`Non-normalized Gini_mean`," ( ",`Non-normalized Gini_quant2.5`," - ", `Non-normalized Gini_quant97.5`," )"),
                 "Normalized Gini" = paste0(`Normalized Gini_mean`," ( ", `Normalized Gini_quant2.5`," - ", `Normalized Gini_quant97.5`," )")) %>% select(site, `Non-normalized Gini`,`Normalized Gini`) %>%
   dplyr::mutate(site = factor(site, levels = names(stream_order_list))) %>%
   knitr::kable(align = "lrr", caption = tab1_caption)

```

```{r raw lorenz, echo=FALSE, message=FALSE, warning = FALSE, dpi = 400, fig.cap="Figure S2. Lorenz plot of relative community flux by species in ascending order of annual population organic matter flux (mg AFDM m^-2^ y^-1^)"}
drake::loadd(lorenz_skew_fig)
lorenz_skew_fig[["lorenz_flux_plot"]]

```

```{r biomass lorenz, echo=FALSE, message=FALSE, warning=FALSE, dpi = 400, fig.cap="Figure S3. Cumulative plot of relative community flux by species in relation to mean annual population biomass (mg m^-2^)."}
lorenz_skew_fig[["bio_lorenz_flux_plot"]]

```

```{r skew distribution, echo = FALSE, warning=FALSE, message=FALSE, fig.cap="Figure S4. Probability distribution of empirical Sk~flux~ measurements in relation to (a) mean body size and (b) annual P:B compared to random species ordering. The red lines represent the 2.5% and 97.5% percentiles of the Sk~flux~ values from random ordering distributions in each stream community."}
drake::loadd(random_skew_fig)
grid.arrange(random_skew_fig[["M_perc_plot"]], random_skew_fig[["pb_perc_plot"]], ncol = 1, left = text_grob(""))

```

\newpage

### Construction zone

Possible other themes to layer in:

effects of temperature on species evenness, evenness of fluxes, and the statistical and ecological constraints on the organization of energy fluxes in communities (e.g., [@diaz2021a] SAD are more uneven than their statistical background and energy fluxes are also but there is important structure in this unevenness). This relates to the random vs non-random patterning questions...pull in the concepts of niche filtering and neutral processes in community assembly. Pull a little thinking from @saito2021.

Below is more of a set-up for the next paper but a little foreshadowing and hand waving may find a place in here:

These maximize energy intake when resources are available [@atkinson1997]

- Seasonal systems have unique constraints
- These seasonal constraints are greater at higher temps

This creates a situation where body sizes are selected for that 1) stabilize c-r dynamics [@osmond2017], ecological stability response to warming [@fussmann2014],...
2) optimize for energy availability and demand, 3) and this selection is stronger at extreme temperatures.

### Spare(d) words from previous versions. Keeping around for now.

directly kinetic effects and indirectly through the distribution of species traits, such as body size, within and across species [@bideault2019; @nelson2017].

environmental filtering of compared the observed distributions of material fluxes among consumer populations to random distributions to quantify the likelihood the patterning of organic matter fluxes arise through random ordering of species or  measure the potential strength of environmental filtering on the relative distribution of organic matter   we tested the potential strength of environmental filtering to determine the distribution of within stream energy fluxes by comparing the  how likely it was  Third, we hypothesized that the selective pressure from environmental temperature on body sizes and population turnover would be greatest at temperature extremes, therefore, the patterning of energy fluxes will be 'non-random' at coldest and warmest temperatures.

Yet, considerable uncertainty remains in the predicted short- and long-term effects of climate warming, especially at higher levels of organization such as communities and food webs [@woodward2010; @walther2002]. For example, species interactions in food webs may modulate species' TSRs [@delong2014], leading to varied responses among species and trophic levels [@ohlberger2013]. Additionally, warming-induced body size reductions may act as a stabilizing process in some consumer-resource interactions through reduced consumer:resource biomass ratios [@osmond2017] and reductions in consumer growth rates relative to resource supply [@kozlowski2004; @delong2012a; @mccann2011; @greyson-gaito2022]. 

For example, we lack a complete understanding of TSRs to explain deviations that exist across taxonomic groups (e.g., diatoms, @adams2013; invertebrates @zeuss2017; birds @geist1987; and fish @rypel2014). Explanations for these deviations vary [@ohlberger2013], some highlight additional processes such as competition and predation [@delong2014], while others propose alternative models of organism body size optimization, such as the balance of resource supply and energy demand [e.g., @kozlowski2004; @delong2012a]. Crucially, these alternative models highlight the trade-off between asymptotic body size and metabolic demand [@delong2012a] that can shape life history patterns (i.e., voltinism, @zeuss2017; @nelson2020b).  and community structure across ecosystems...

Recent, models have proposed  However, 
- both bottom-up (e.g. resource supply) and top-down (e.g., predation) proceesses
- competition and predation [@delong2014], stabilize c-r dynamics [@osmond2017], optimization, such as the balance of resource supply and energy demand [e.g., @kozlowski2004; @delong2012a]

To assess the relationship between the probability of 'non-random ordering' and temperature, we used beta regression on estimates of the probability of seeing the empirical $Sk_{flux}$ value or one more extreme based on random ordering of species in the permuted feasible set. Here, values can take the range between 0 and 1 so no transformation was necessary. As necessary when we observed many values near 0 and 1, we implemented a zero-one inflated beta regressions in brms [@burkner2017] to test if the probability of observing the empirical $Sk_{flux}$ was associated with mean annual temperature across streams. We predicted increasingly 'non-random' distributions in OM fluxes with increasing temperature.

Warmer streams had communities with smaller mean body sizes and faster turnover rates on average (Figure 2). Both among and within streams, OM fluxes were distributed differently across body sizes and turnover rates (*P:B*). Among streams, mean population body size ranged from `r m_summ %>% slice_min(M_mg_ind_mean) %>% select(M_mg_ind_mean) %>% round(2)` to `r m_summ %>% slice_max(M_mg_ind_mean) %>% select(M_mg_ind_mean)%>% round(2)` mg ind^-1^ and mean population annual  P:B ranged from `r pb_summ %>% slice_min(pb_y_mean) %>% select(pb_y_mean)%>% round(2)` to `r pb_summ %>% slice_max(pb_y_mean) %>% select(pb_y_mean)%>% round(2)` (Figure 2).Both, *M* and *P:B* showed associations with mean annual stream temperature that were negative and positive, respectively. Generally, mean *M* of the community decreased `r M_temp_coef_mean`% (95% PI, `r M_temp_coef_quant2.5`% -- `r M_temp_coef_quant97.5`%) for each increase in 1$^\circ$C. In contrast, mean population *P:B* of the community increased `r pb_temp_coef_mean`% (95% PI, `r pb_temp_coef_quant2.5`% -- `r pb_temp_coef_quant97.5`%) for each 1$^\circ$C in mean annual stream temperature. 
